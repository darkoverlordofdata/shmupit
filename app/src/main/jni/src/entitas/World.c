/** updated by adriac */
/* World.c generated by valac 0.36.4-dirty, the Vala compiler
 * generated from World.vala, do not modify */

/*[Adriac:Entitas::World:EntitasWorld:entitas_world]*/
/* ******************************************************************************
 *# MIT License
 *
 * Copyright (c) 2015-2017 Bruce Davidson &lt;darkoverlordofdata@gmail.com&gt;
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * 'Software'), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
 * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

#include <glib.h>
#include <glib-object.h>
#include <stdlib.h>
#include <string.h>
#include <float.h>
#include <math.h>
#include <SDL_rect.h>

typedef struct _EntitasWorld EntitasWorld;

#define ENTITAS_TYPE_ENTITY (entitas_entity_get_type ())

#define ENTITAS_TYPE_TRANSFORM (entitas_transform_get_type ())

#define SDX_MATH_TYPE_VECTOR2 (sdx_math_vector2_get_type ())
typedef struct _SdxMathVector2 SdxMathVector2;
typedef struct _SdxGraphicsSprite SdxGraphicsSprite;
typedef struct _EntitasTransform EntitasTransform;
typedef struct _EntitasEventEntityChanged EntitasEventEntityChanged;
typedef struct _EntitasEventEntityReleased EntitasEventEntityReleased;
typedef struct _EntitasEventComponentReplaced EntitasEventComponentReplaced;

#define ENTITAS_TYPE_BACKGROUND (entitas_background_get_type ())
typedef struct _EntitasBackground EntitasBackground;

#define ENTITAS_TYPE_BULLET (entitas_bullet_get_type ())
typedef struct _EntitasBullet EntitasBullet;

#define ENTITAS_TYPE_ENEMY1 (entitas_enemy1_get_type ())
typedef struct _EntitasEnemy1 EntitasEnemy1;

#define ENTITAS_TYPE_ENEMY2 (entitas_enemy2_get_type ())
typedef struct _EntitasEnemy2 EntitasEnemy2;

#define ENTITAS_TYPE_ENEMY3 (entitas_enemy3_get_type ())
typedef struct _EntitasEnemy3 EntitasEnemy3;

#define ENTITAS_TYPE_EXPIRES (entitas_expires_get_type ())
typedef struct _EntitasExpires EntitasExpires;

#define ENTITAS_TYPE_HEALTH (entitas_health_get_type ())
typedef struct _EntitasHealth EntitasHealth;

#define ENTITAS_TYPE_HUD (entitas_hud_get_type ())
typedef struct _EntitasHud EntitasHud;

#define ENTITAS_TYPE_LAYER (entitas_layer_get_type ())
typedef struct _EntitasLayer EntitasLayer;

#define ENTITAS_TYPE_PLAYER (entitas_player_get_type ())
typedef struct _EntitasPlayer EntitasPlayer;

#define ENTITAS_TYPE_SHOW (entitas_show_get_type ())
typedef struct _EntitasShow EntitasShow;

#define ENTITAS_TYPE_SOUND (entitas_sound_get_type ())
typedef struct _SdxAudioSound SdxAudioSound;
typedef struct _EntitasSound EntitasSound;

#define ENTITAS_TYPE_TEXT (entitas_text_get_type ())
typedef SdxGraphicsSprite SdxGraphicsSpriteTextSprite;
typedef struct _EntitasText EntitasText;

#define ENTITAS_TYPE_TINT (entitas_tint_get_type ())
typedef struct _EntitasTint EntitasTint;

#define ENTITAS_TYPE_TWEEN (entitas_tween_get_type ())
typedef struct _EntitasTween EntitasTween;

#define ENTITAS_TYPE_VELOCITY (entitas_velocity_get_type ())
typedef struct _EntitasVelocity EntitasVelocity;
typedef struct _EntitasEntity EntitasEntity;

#define ENTITAS_TYPE_ISYSTEM (entitas_isystem_get_type ())
typedef struct _EntitasISystem EntitasISystem;
typedef struct _EntitasGroup EntitasGroup;
typedef struct _EntitasEventWorldChanged EntitasEventWorldChanged;
typedef struct _EntitasEventGroupsChanged EntitasEventGroupsChanged;
#define __g_list_free__entitas_group_release0_0(var) ((var == NULL) ? NULL : (var = (_g_list_free__entitas_group_release0_ (var), NULL)))
// symtbl.1 entitas_event_world_changed
void entitas_event_world_changed_release (EntitasEventWorldChanged* self);
void entitas_event_world_changed_free (EntitasEventWorldChanged* self);
EntitasEventWorldChanged* entitas_event_world_changed_retain (EntitasEventWorldChanged* self);
#define _entitas_event_world_changed_release0(var) ((var == NULL) ? NULL : (var = (entitas_event_world_changed_release (var), NULL)))
// symtbl.1 entitas_event_groups_changed
void entitas_event_groups_changed_release (EntitasEventGroupsChanged* self);
void entitas_event_groups_changed_free (EntitasEventGroupsChanged* self);
EntitasEventGroupsChanged* entitas_event_groups_changed_retain (EntitasEventGroupsChanged* self);
#define _entitas_event_groups_changed_release0(var) ((var == NULL) ? NULL : (var = (entitas_event_groups_changed_release (var), NULL)))

#define ENTITAS_TYPE_BUFFER (entitas_buffer_get_type ())
typedef struct _EntitasBuffer EntitasBuffer;
#define _g_ptr_array_unref0(var) ((var == NULL) ? NULL : (var = (g_ptr_array_unref (var), NULL)))
typedef struct _EntitasSystem EntitasSystem;
// symtbl.1 entitas_group
void entitas_group_release (EntitasGroup* self);
void entitas_group_free (EntitasGroup* self);
EntitasGroup* entitas_group_retain (EntitasGroup* self);
#define _entitas_group_release0(var) ((var == NULL) ? NULL : (var = (entitas_group_release (var), NULL)))
typedef struct _EntitasEventWorldChangedListener EntitasEventWorldChangedListener;
typedef struct _EntitasMatcher EntitasMatcher;
typedef struct _EntitasEventGroupsChangedListener EntitasEventGroupsChangedListener;

struct _SdxMathVector2 {
	gfloat x;
	gfloat y;
};

struct _EntitasTransform {
	SdxMathVector2* scale;
	SdxMathVector2* position;
	SDL_Rect* aabb;
	SdxGraphicsSprite* sprite;
};

struct _EntitasBackground {
	gboolean active;
};

struct _EntitasBullet {
	gboolean active;
};

struct _EntitasEnemy1 {
	gboolean active;
};

struct _EntitasEnemy2 {
	gboolean active;
};

struct _EntitasEnemy3 {
	gboolean active;
};

struct _EntitasExpires {
	gfloat value;
};

struct _EntitasHealth {
	gfloat current;
	gfloat maximum;
};

struct _EntitasHud {
	gboolean active;
};

struct _EntitasLayer {
	gint value;
};

struct _EntitasPlayer {
	gboolean active;
};

struct _EntitasShow {
	gboolean active;
};

struct _EntitasSound {
	SdxAudioSound* sound;
};

struct _EntitasText {
	gchar* text;
	SdxGraphicsSpriteTextSprite* sprite;
};

struct _EntitasTint {
	gint r;
	gint g;
	gint b;
	gint a;
};

struct _EntitasTween {
	gfloat min;
	gfloat max;
	gfloat speed;
	gboolean repeat;
	gboolean active;
};

struct _EntitasVelocity {
	gfloat x;
	gfloat y;
};

struct _EntitasEntity {
	gint id;
	gchar* name;
	gint pool;
	guint64 mask;
	EntitasTransform transform;
	EntitasEventEntityChanged* onComponentAdded;
	EntitasEventEntityChanged* onComponentRemoved;
	EntitasEventEntityReleased* onEntityReleased;
	EntitasEventComponentReplaced* onComponentReplaced;
	EntitasBackground* background;
	EntitasBullet* bullet;
	EntitasEnemy1* enemy1;
	EntitasEnemy2* enemy2;
	EntitasEnemy3* enemy3;
	EntitasExpires* expires;
	EntitasHealth* health;
	EntitasHud* hud;
	EntitasLayer* layer;
	EntitasPlayer* player;
	EntitasShow* show;
	EntitasSound* sound;
	EntitasText* text;
	EntitasTint* tint;
	EntitasTween* tween;
	EntitasVelocity* velocity;
};

typedef void (*EntitasSystemInitialize) (void* user_data);
typedef void (*EntitasSystemExecute) (gfloat delta, void* user_data);
struct _EntitasISystem {
	EntitasSystemInitialize Initialize;
	gpointer Initialize_target;
	GDestroyNotify Initialize_target_destroy_notify;
	EntitasSystemExecute Execute;
	gpointer Execute_target;
	GDestroyNotify Execute_target_destroy_notify;
};

struct _EntitasWorld {
	gint ref_count;
	gint id;
	EntitasEntity* pool;
	gint pool_length1;
	EntitasISystem* systems;
	gint systems_length1;
	GPtrArray** cache;
	gint cache_length1;
	GList* groups;
	EntitasEventWorldChanged* onEntityCreated;
	EntitasEventWorldChanged* onEntityWillBeDestroyed;
	EntitasEventWorldChanged* onEntityDestroyed;
	EntitasEventGroupsChanged* onGroupCreated;
};

typedef EntitasEntity* (*EntitasEntityFactory) (void* user_data);
struct _EntitasBuffer {
	gint pool;
	gint size;
	EntitasEntityFactory Factory;
	gpointer Factory_target;
	GDestroyNotify Factory_target_destroy_notify;
};

typedef void (*EntitasEventWorldChangedHandler) (EntitasWorld* w, EntitasEntity* e, void* user_data);
struct _EntitasEventWorldChanged {
	gint ref_count;
	GPtrArray* listeners;
	EntitasEventWorldChangedHandler Dispatch;
	gpointer Dispatch_target;
	GDestroyNotify Dispatch_target_destroy_notify;
};

typedef void (*EntitasEventEntityChangedHandler) (EntitasEntity* e, gint index, void* component, void* user_data);
typedef void (*EntitasEventEntityReleasedHandler) (EntitasEntity* e, void* user_data);
typedef void (*EntitasEventComponentReplacedHandler) (EntitasEntity* e, gint index, void* component, void* replacement, void* user_data);
struct _EntitasMatcher {
	gint ref_count;
	gint id;
	gint* allOfIndices;
	gint allOfIndices_length1;
	guint64 allOfMask;
	gint* anyOfIndices;
	gint anyOfIndices_length1;
	guint64 anyOfMask;
	gint* noneOfIndices;
	gint noneOfIndices_length1;
	guint64 noneOfMask;
	gint* indices;
	gint indices_length1;
	gchar* toStringCache;
};

typedef void (*EntitasEventGroupsChangedHandler) (EntitasWorld* w, EntitasGroup* g, void* user_data);
struct _EntitasEventGroupsChanged {
	gint ref_count;
	GPtrArray* listeners;
	EntitasEventGroupsChangedHandler Dispatch;
	gpointer Dispatch_target;
	GDestroyNotify Dispatch_target_destroy_notify;
};



void entitas_world_free (EntitasWorld * self);
GType entitas_entity_get_type (void) G_GNUC_CONST;
GType entitas_transform_get_type (void) G_GNUC_CONST;
GType sdx_math_vector2_get_type (void) G_GNUC_CONST;
SdxMathVector2* sdx_math_vector2_dup (const SdxMathVector2* self);
void sdx_math_vector2_free (SdxMathVector2* self);
void sdx_graphics_sprite_free (SdxGraphicsSprite * self);
EntitasTransform* entitas_transform_dup (const EntitasTransform* self);
void entitas_transform_free (EntitasTransform* self);
void entitas_transform_copy (const EntitasTransform* self, EntitasTransform* dest);
void entitas_transform_destroy (EntitasTransform* self);
void entitas_event_entity_changed_free (EntitasEventEntityChanged * self);
void entitas_event_entity_released_free (EntitasEventEntityReleased * self);
void entitas_event_component_replaced_free (EntitasEventComponentReplaced * self);
GType entitas_background_get_type (void) G_GNUC_CONST;
EntitasBackground* entitas_background_dup (const EntitasBackground* self);
void entitas_background_free (EntitasBackground* self);
GType entitas_bullet_get_type (void) G_GNUC_CONST;
EntitasBullet* entitas_bullet_dup (const EntitasBullet* self);
void entitas_bullet_free (EntitasBullet* self);
GType entitas_enemy1_get_type (void) G_GNUC_CONST;
EntitasEnemy1* entitas_enemy1_dup (const EntitasEnemy1* self);
void entitas_enemy1_free (EntitasEnemy1* self);
GType entitas_enemy2_get_type (void) G_GNUC_CONST;
EntitasEnemy2* entitas_enemy2_dup (const EntitasEnemy2* self);
void entitas_enemy2_free (EntitasEnemy2* self);
GType entitas_enemy3_get_type (void) G_GNUC_CONST;
EntitasEnemy3* entitas_enemy3_dup (const EntitasEnemy3* self);
void entitas_enemy3_free (EntitasEnemy3* self);
GType entitas_expires_get_type (void) G_GNUC_CONST;
EntitasExpires* entitas_expires_dup (const EntitasExpires* self);
void entitas_expires_free (EntitasExpires* self);
GType entitas_health_get_type (void) G_GNUC_CONST;
EntitasHealth* entitas_health_dup (const EntitasHealth* self);
void entitas_health_free (EntitasHealth* self);
GType entitas_hud_get_type (void) G_GNUC_CONST;
EntitasHud* entitas_hud_dup (const EntitasHud* self);
void entitas_hud_free (EntitasHud* self);
GType entitas_layer_get_type (void) G_GNUC_CONST;
EntitasLayer* entitas_layer_dup (const EntitasLayer* self);
void entitas_layer_free (EntitasLayer* self);
GType entitas_player_get_type (void) G_GNUC_CONST;
EntitasPlayer* entitas_player_dup (const EntitasPlayer* self);
void entitas_player_free (EntitasPlayer* self);
GType entitas_show_get_type (void) G_GNUC_CONST;
EntitasShow* entitas_show_dup (const EntitasShow* self);
void entitas_show_free (EntitasShow* self);
GType entitas_sound_get_type (void) G_GNUC_CONST;
void sdx_audio_sound_free (SdxAudioSound * self);
EntitasSound* entitas_sound_dup (const EntitasSound* self);
void entitas_sound_free (EntitasSound* self);
void entitas_sound_copy (const EntitasSound* self, EntitasSound* dest);
void entitas_sound_destroy (EntitasSound* self);
GType entitas_text_get_type (void) G_GNUC_CONST;
EntitasText* entitas_text_dup (const EntitasText* self);
void entitas_text_free (EntitasText* self);
void entitas_text_copy (const EntitasText* self, EntitasText* dest);
void entitas_text_destroy (EntitasText* self);
GType entitas_tint_get_type (void) G_GNUC_CONST;
EntitasTint* entitas_tint_dup (const EntitasTint* self);
void entitas_tint_free (EntitasTint* self);
GType entitas_tween_get_type (void) G_GNUC_CONST;
EntitasTween* entitas_tween_dup (const EntitasTween* self);
void entitas_tween_free (EntitasTween* self);
GType entitas_velocity_get_type (void) G_GNUC_CONST;
EntitasVelocity* entitas_velocity_dup (const EntitasVelocity* self);
void entitas_velocity_free (EntitasVelocity* self);
EntitasEntity* entitas_entity_dup (const EntitasEntity* self);
void entitas_entity_free (EntitasEntity* self);
void entitas_entity_copy (const EntitasEntity* self, EntitasEntity* dest);
void entitas_entity_destroy (EntitasEntity* self);
GType entitas_isystem_get_type (void) G_GNUC_CONST;
EntitasISystem* entitas_isystem_dup (const EntitasISystem* self);
void entitas_isystem_free (EntitasISystem* self);
void entitas_isystem_copy (const EntitasISystem* self, EntitasISystem* dest);
void entitas_isystem_destroy (EntitasISystem* self);
void entitas_group_free (EntitasGroup * self);
void entitas_event_world_changed_free (EntitasEventWorldChanged * self);
void entitas_event_groups_changed_free (EntitasEventGroupsChanged * self);
static void entitas_world_instance_init (EntitasWorld * self);
static void _vala_EntitasEntity_array_free (EntitasEntity * array, gint array_length);
static void _vala_EntitasISystem_array_free (EntitasISystem * array, gint array_length);
// symtbl.2 entitas_group
void entitas_group_release (EntitasGroup* self);
void entitas_group_free (EntitasGroup* self);
EntitasGroup* entitas_group_retain (EntitasGroup* self);
static void _entitas_group_release0_ (gpointer var);
static void _g_list_free__entitas_group_release0_ (GList* self);
EntitasWorld* entitas_world_retain (EntitasWorld* self);
void entitas_world_release (EntitasWorld* self);
void entitas_world_free (EntitasWorld* self);
EntitasWorld* entitas_world_new (void);
EntitasEventGroupsChanged* entitas_event_groups_changed_new (void);
EntitasEventWorldChanged* entitas_event_world_changed_new (void);
GType entitas_buffer_get_type (void) G_GNUC_CONST;
EntitasBuffer* entitas_buffer_dup (const EntitasBuffer* self);
void entitas_buffer_free (EntitasBuffer* self);
void entitas_buffer_copy (const EntitasBuffer* self, EntitasBuffer* dest);
void entitas_buffer_destroy (EntitasBuffer* self);
void entitas_world_SetPool (EntitasWorld* self, gint size, gint count, EntitasBuffer* buffers, int buffers_length1);
void entitas_system_free (EntitasSystem * self);
EntitasWorld* entitas_world_AddSystem (EntitasWorld* self, EntitasSystem* system);
static EntitasISystem* _vala_array_dup1 (EntitasISystem* self, int length);
void entitas_system_get_ISystem (EntitasSystem* self, EntitasISystem * result);
static void _vala_array_add7 (EntitasISystem* * array, int* length, int* size, const EntitasISystem* value);
static EntitasISystem* _vala_array_dup2 (EntitasISystem* self, int length);
void entitas_world_Initialize (EntitasWorld* self);
void entitas_world_Execute (EntitasWorld* self, gfloat delta);
void entitas_world_ComponentAddedOrRemoved (EntitasWorld* self, EntitasEntity* entity, gint index, void* component);
void entitas_group_HandleEntity (EntitasGroup* self, EntitasEntity* entity, gint index, void* component);
void entitas_world_DeleteEntity (EntitasWorld* self, EntitasEntity* entity);
void entitas_event_world_changed_listener_free (EntitasEventWorldChangedListener * self);
void entitas_entity_Destroy (EntitasEntity *self);
void entitas_world_onEntityReleased (EntitasWorld* self, EntitasEntity* e);
void entitas_world_onComponentReplaced (EntitasWorld* self, EntitasEntity* e, gint index, void* component, void* replacement);
EntitasEntity* entitas_world_CreateEntity (EntitasWorld* self, const gchar* name, gint pool, gboolean active);
static void _entitas_world_ComponentAddedOrRemoved_entitas_event_entity_changed_handler (EntitasEntity* e, gint index, void* component, gpointer self);
static void _entitas_world_onEntityReleased_entitas_event_entity_released_handler (EntitasEntity* e, gpointer self);
static void _entitas_world_onComponentReplaced_entitas_event_component_replaced_handler (EntitasEntity* e, gint index, void* component, void* replacement, gpointer self);
void entitas_entity_init (EntitasEntity *self, gint id, EntitasEventEntityChangedHandler ComponentAddedOrRemoved, void* ComponentAddedOrRemoved_target, EntitasEventEntityReleasedHandler ComponentEntityReleased, void* ComponentEntityReleased_target, EntitasEventComponentReplacedHandler ComponentComponentReplaced, void* ComponentComponentReplaced_target);
EntitasEntity* entitas_entity_SetName (EntitasEntity *self, const gchar* name);
EntitasEntity* entitas_entity_SetPool (EntitasEntity *self, gint pool);
EntitasEntity* entitas_entity_SetActive (EntitasEntity *self, gboolean active);
void entitas_matcher_free (EntitasMatcher * self);
EntitasGroup* entitas_world_GetGroup (EntitasWorld* self, EntitasMatcher* matcher);
EntitasGroup* entitas_group_new (EntitasMatcher* matcher);
void entitas_group_HandleEntitySilently (EntitasGroup* self, EntitasEntity* entity);
void entitas_event_groups_changed_listener_free (EntitasEventGroupsChangedListener * self);
static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func);


static void _vala_EntitasEntity_array_free (EntitasEntity * array, gint array_length) {
	if (array != NULL) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			entitas_entity_destroy (&array[i]);
		}
	}
	g_free (array);
}


static void _vala_EntitasISystem_array_free (EntitasISystem * array, gint array_length) {
	if (array != NULL) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			entitas_isystem_destroy (&array[i]);
		}
	}
	g_free (array);
}


// symtbl.2 entitas_group
void entitas_group_release (EntitasGroup* self);
void entitas_group_free (EntitasGroup* self);
EntitasGroup* entitas_group_retain (EntitasGroup* self);
static void _entitas_group_release0_ (gpointer var) {
	(var == NULL) ? NULL : (var = (entitas_group_release (var), NULL));
}


static void _g_list_free__entitas_group_release0_ (GList* self) {
	g_list_foreach (self, (GFunc) _entitas_group_release0_, NULL);
	g_list_free (self);
}


EntitasWorld* entitas_world_retain (EntitasWorld* self) {
	EntitasWorld* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_atomic_int_add ((volatile gint *) (&self->ref_count), 1);
	result = self;
	return result;
}


void entitas_world_release (EntitasWorld* self) {
	gboolean _tmp0_;
	g_return_if_fail (self != NULL);
	_tmp0_ = g_atomic_int_dec_and_test ((volatile gint *) (&self->ref_count));
	if (_tmp0_) {
		entitas_world_free (self);
	}
}


EntitasWorld* entitas_world_new (void) {
	EntitasWorld* self;
	EntitasISystem* _tmp0_;
	EntitasEventGroupsChanged* _tmp1_;
	EntitasEventWorldChanged* _tmp2_;
	EntitasEventWorldChanged* _tmp3_;
	EntitasEventWorldChanged* _tmp4_;
	self = g_slice_new0 (EntitasWorld);
	entitas_world_instance_init (self);
	_tmp0_ = g_new0 (EntitasISystem, 0);
	self->systems = (_vala_EntitasISystem_array_free (self->systems, self->systems_length1), NULL);
	self->systems = _tmp0_;
	self->systems_length1 = 0;
	_tmp1_ = entitas_event_groups_changed_new ();
	_entitas_event_groups_changed_release0 (self->onGroupCreated);
	self->onGroupCreated = _tmp1_;
	_tmp2_ = entitas_event_world_changed_new ();
	_entitas_event_world_changed_release0 (self->onEntityCreated);
	self->onEntityCreated = _tmp2_;
	_tmp3_ = entitas_event_world_changed_new ();
	_entitas_event_world_changed_release0 (self->onEntityDestroyed);
	self->onEntityDestroyed = _tmp3_;
	_tmp4_ = entitas_event_world_changed_new ();
	_entitas_event_world_changed_release0 (self->onEntityWillBeDestroyed);
	self->onEntityWillBeDestroyed = _tmp4_;
	return self;
}


void entitas_world_SetPool (EntitasWorld* self, gint size, gint count, EntitasBuffer* buffers, int buffers_length1) {
	gint _tmp0_;
	EntitasEntity* _tmp1_;
	gint _tmp2_;
	GPtrArray** _tmp3_;
	g_return_if_fail (self != NULL);
	_tmp0_ = size;
	_tmp1_ = g_new0 (EntitasEntity, _tmp0_ + 1);
	self->pool = (_vala_EntitasEntity_array_free (self->pool, self->pool_length1), NULL);
	self->pool = _tmp1_;
	self->pool_length1 = _tmp0_ + 1;
	_tmp2_ = count;
	_tmp3_ = g_new0 (GPtrArray*, _tmp2_ + 1);
	self->cache = (_vala_array_free (self->cache, self->cache_length1, (GDestroyNotify) g_ptr_array_unref), NULL);
	self->cache = _tmp3_;
	self->cache_length1 = _tmp2_;
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp4_ = FALSE;
			_tmp4_ = TRUE;
			while (TRUE) {
				gint _tmp6_;
				EntitasBuffer* _tmp7_;
				gint _tmp7__length1;
				gint bufferPool = 0;
				EntitasBuffer* _tmp8_;
				gint _tmp8__length1;
				gint _tmp9_;
				EntitasBuffer _tmp10_;
				gint _tmp11_;
				gint bufferSize = 0;
				EntitasBuffer* _tmp12_;
				gint _tmp12__length1;
				gint _tmp13_;
				EntitasBuffer _tmp14_;
				gint _tmp15_;
				GPtrArray** _tmp16_;
				gint _tmp16__length1;
				gint _tmp17_;
				gint _tmp18_;
				GPtrArray* _tmp19_;
				GPtrArray* _tmp20_;
				if (!_tmp4_) {
					gint _tmp5_;
					_tmp5_ = i;
					i = _tmp5_ + 1;
				}
				_tmp4_ = FALSE;
				_tmp6_ = i;
				_tmp7_ = buffers;
				_tmp7__length1 = buffers_length1;
				if (!(_tmp6_ < _tmp7__length1)) {
					break;
				}
				_tmp8_ = buffers;
				_tmp8__length1 = buffers_length1;
				_tmp9_ = i;
				_tmp10_ = _tmp8_[_tmp9_];
				_tmp11_ = _tmp10_.pool;
				bufferPool = _tmp11_;
				_tmp12_ = buffers;
				_tmp12__length1 = buffers_length1;
				_tmp13_ = i;
				_tmp14_ = _tmp12_[_tmp13_];
				_tmp15_ = _tmp14_.size;
				bufferSize = _tmp15_;
				_tmp16_ = self->cache;
				_tmp16__length1 = self->cache_length1;
				_tmp17_ = bufferPool;
				_tmp18_ = bufferSize;
				_tmp19_ = g_ptr_array_new_full ((guint) _tmp18_, NULL);
				_g_ptr_array_unref0 (_tmp16_[_tmp17_]);
				_tmp16_[_tmp17_] = _tmp19_;
				_tmp20_ = _tmp16_[_tmp17_];
				{
					gint k = 0;
					k = 0;
					{
						gboolean _tmp21_ = FALSE;
						_tmp21_ = TRUE;
						while (TRUE) {
							gint _tmp23_;
							gint _tmp24_;
							GPtrArray** _tmp25_;
							gint _tmp25__length1;
							gint _tmp26_;
							GPtrArray* _tmp27_;
							EntitasBuffer* _tmp28_;
							gint _tmp28__length1;
							gint _tmp29_;
							EntitasBuffer _tmp30_;
							EntitasEntityFactory _tmp31_;
							void* _tmp31__target;
							EntitasEntity* _tmp32_;
							if (!_tmp21_) {
								gint _tmp22_;
								_tmp22_ = k;
								k = _tmp22_ + 1;
							}
							_tmp21_ = FALSE;
							_tmp23_ = k;
							_tmp24_ = bufferSize;
							if (!(_tmp23_ < _tmp24_)) {
								break;
							}
							_tmp25_ = self->cache;
							_tmp25__length1 = self->cache_length1;
							_tmp26_ = bufferPool;
							_tmp27_ = _tmp25_[_tmp26_];
							_tmp28_ = buffers;
							_tmp28__length1 = buffers_length1;
							_tmp29_ = i;
							_tmp30_ = _tmp28_[_tmp29_];
							_tmp31_ = _tmp30_.Factory;
							_tmp31__target = _tmp30_.Factory_target;
							_tmp32_ = _tmp31_ (_tmp31__target);
							g_ptr_array_add (_tmp27_, _tmp32_);
						}
					}
				}
			}
		}
	}
}


/**
         * add System
         * @param system to add
         * @return this world
         */
static EntitasISystem* _vala_array_dup1 (EntitasISystem* self, int length) {
	EntitasISystem* result;
	int i;
	result = g_new0 (EntitasISystem, length);
	for (i = 0; i < length; i++) {
		EntitasISystem _tmp0_ = {0};
		entitas_isystem_copy (&self[i], &_tmp0_);
		result[i] = _tmp0_;
	}
	return result;
}


static void _vala_array_add7 (EntitasISystem* * array, int* length, int* size, const EntitasISystem* value) {
	if ((*length) == (*size)) {
		*size = (*size) ? (2 * (*size)) : 4;
		*array = g_renew (EntitasISystem, *array, *size);
	}
	(*array)[(*length)++] = *value;
}


static EntitasISystem* _vala_array_dup2 (EntitasISystem* self, int length) {
	EntitasISystem* result;
	int i;
	result = g_new0 (EntitasISystem, length);
	for (i = 0; i < length; i++) {
		EntitasISystem _tmp0_ = {0};
		entitas_isystem_copy (&self[i], &_tmp0_);
		result[i] = _tmp0_;
	}
	return result;
}


static gpointer _entitas_world_retain0 (gpointer self) {
	return self ? entitas_world_retain (self) : NULL;
}


EntitasWorld* entitas_world_AddSystem (EntitasWorld* self, EntitasSystem* system) {
	EntitasWorld* result = NULL;
	EntitasISystem* sy = NULL;
	EntitasISystem* _tmp0_;
	gint _tmp0__length1;
	EntitasISystem* _tmp1_;
	gint _tmp1__length1;
	gint sy_length1;
	gint _sy_size_;
	EntitasISystem* _tmp2_;
	gint _tmp2__length1;
	EntitasSystem* _tmp3_;
	EntitasISystem _tmp4_ = {0};
	EntitasISystem _tmp5_;
	EntitasISystem _tmp6_ = {0};
	EntitasISystem* _tmp7_;
	gint _tmp7__length1;
	EntitasISystem* _tmp8_;
	gint _tmp8__length1;
	EntitasWorld* _tmp9_;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (system != NULL, NULL);
	_tmp0_ = self->systems;
	_tmp0__length1 = self->systems_length1;
	_tmp1_ = (_tmp0_ != NULL) ? _vala_array_dup1 (_tmp0_, _tmp0__length1) : ((gpointer) _tmp0_);
	_tmp1__length1 = _tmp0__length1;
	sy = _tmp1_;
	sy_length1 = _tmp1__length1;
	_sy_size_ = sy_length1;
	_tmp2_ = sy;
	_tmp2__length1 = sy_length1;
	_tmp3_ = system;
	entitas_system_get_ISystem (_tmp3_, &_tmp4_);
	_tmp5_ = _tmp4_;
	entitas_isystem_copy (&_tmp5_, &_tmp6_);
	_vala_array_add7 (&sy, &sy_length1, &_sy_size_, &_tmp6_);
	_tmp7_ = sy;
	_tmp7__length1 = sy_length1;
	_tmp8_ = (_tmp7_ != NULL) ? _vala_array_dup2 (_tmp7_, _tmp7__length1) : ((gpointer) _tmp7_);
	_tmp8__length1 = _tmp7__length1;
	self->systems = (_vala_EntitasISystem_array_free (self->systems, self->systems_length1), NULL);
	self->systems = _tmp8_;
	self->systems_length1 = _tmp8__length1;
	_tmp9_ = _entitas_world_retain0 (self);
	result = _tmp9_;
	sy = (_vala_EntitasISystem_array_free (sy, sy_length1), NULL);
	return result;
}


/**
         * Initialize Systems
         */
void entitas_world_Initialize (EntitasWorld* self) {
	EntitasISystem* _tmp0_;
	gint _tmp0__length1;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->systems;
	_tmp0__length1 = self->systems_length1;
	{
		EntitasISystem* system_collection = NULL;
		gint system_collection_length1 = 0;
		gint _system_collection_size_ = 0;
		gint system_it = 0;
		system_collection = _tmp0_;
		system_collection_length1 = _tmp0__length1;
		for (system_it = 0; system_it < _tmp0__length1; system_it = system_it + 1) {
			EntitasISystem _tmp1_ = {0};
			EntitasISystem system = {0};
			entitas_isystem_copy (&system_collection[system_it], &_tmp1_);
			system = _tmp1_;
			{
				EntitasISystem _tmp2_;
				EntitasSystemInitialize _tmp3_;
				void* _tmp3__target;
				_tmp2_ = system;
				_tmp3_ = _tmp2_.Initialize;
				_tmp3__target = _tmp2_.Initialize_target;
				_tmp3_ (_tmp3__target);
				entitas_isystem_destroy (&system);
			}
		}
	}
}


/**
         * Execute Systems
         */
void entitas_world_Execute (EntitasWorld* self, gfloat delta) {
	EntitasISystem* _tmp0_;
	gint _tmp0__length1;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->systems;
	_tmp0__length1 = self->systems_length1;
	{
		EntitasISystem* system_collection = NULL;
		gint system_collection_length1 = 0;
		gint _system_collection_size_ = 0;
		gint system_it = 0;
		system_collection = _tmp0_;
		system_collection_length1 = _tmp0__length1;
		for (system_it = 0; system_it < _tmp0__length1; system_it = system_it + 1) {
			EntitasISystem _tmp1_ = {0};
			EntitasISystem system = {0};
			entitas_isystem_copy (&system_collection[system_it], &_tmp1_);
			system = _tmp1_;
			{
				EntitasISystem _tmp2_;
				EntitasSystemExecute _tmp3_;
				void* _tmp3__target;
				gfloat _tmp4_;
				_tmp2_ = system;
				_tmp3_ = _tmp2_.Execute;
				_tmp3__target = _tmp2_.Execute_target;
				_tmp4_ = delta;
				_tmp3_ (_tmp4_, _tmp3__target);
				entitas_isystem_destroy (&system);
			}
		}
	}
}


/**
         * @param entity that was updated
         * @param index of component
         * @param component that was added or removed
         */
static gpointer _entitas_group_retain0 (gpointer self) {
	return self ? entitas_group_retain (self) : NULL;
}


void entitas_world_ComponentAddedOrRemoved (EntitasWorld* self, EntitasEntity* entity, gint index, void* component) {
	GList* _tmp0_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->groups;
	{
		GList* group_collection = NULL;
		GList* group_it = NULL;
		group_collection = _tmp0_;
		for (group_it = group_collection; group_it != NULL; group_it = group_it->next) {
			EntitasGroup* _tmp1_;
			EntitasGroup* group = NULL;
			_tmp1_ = _entitas_group_retain0 ((EntitasGroup*) group_it->data);
			group = _tmp1_;
			{
				EntitasGroup* _tmp2_;
				EntitasEntity* _tmp3_;
				gint _tmp4_;
				void* _tmp5_;
				_tmp2_ = group;
				_tmp3_ = entity;
				_tmp4_ = index;
				_tmp5_ = component;
				entitas_group_HandleEntity (_tmp2_, _tmp3_, _tmp4_, _tmp5_);
				_entitas_group_release0 (group);
			}
		}
	}
}


/**
         * Destroy an entity
         * @param entity entity
         */
void entitas_world_DeleteEntity (EntitasWorld* self, EntitasEntity* entity) {
	EntitasEventWorldChanged* _tmp0_;
	EntitasEventWorldChangedHandler _tmp1_;
	void* _tmp1__target;
	EntitasEntity* _tmp2_;
	EntitasEventWorldChanged* _tmp3_;
	EntitasEventWorldChangedHandler _tmp4_;
	void* _tmp4__target;
	EntitasEntity* _tmp5_;
	GPtrArray** _tmp6_;
	gint _tmp6__length1;
	EntitasEntity* _tmp7_;
	gint _tmp8_;
	GPtrArray* _tmp9_;
	EntitasEntity* _tmp10_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->onEntityWillBeDestroyed;
	_tmp1_ = _tmp0_->Dispatch;
	_tmp1__target = _tmp0_->Dispatch_target;
	_tmp2_ = entity;
	_tmp1_ (self, _tmp2_, _tmp1__target);
	entitas_entity_Destroy (entity);
	_tmp3_ = self->onEntityDestroyed;
	_tmp4_ = _tmp3_->Dispatch;
	_tmp4__target = _tmp3_->Dispatch_target;
	_tmp5_ = entity;
	_tmp4_ (self, _tmp5_, _tmp4__target);
	_tmp6_ = self->cache;
	_tmp6__length1 = self->cache_length1;
	_tmp7_ = entity;
	_tmp8_ = (*_tmp7_).pool;
	_tmp9_ = _tmp6_[_tmp8_];
	_tmp10_ = entity;
	g_ptr_array_add (_tmp9_, _tmp10_);
}


void entitas_world_onEntityReleased (EntitasWorld* self, EntitasEntity* e) {
	g_return_if_fail (self != NULL);
}


void entitas_world_onComponentReplaced (EntitasWorld* self, EntitasEntity* e, gint index, void* component, void* replacement) {
	g_return_if_fail (self != NULL);
}


/**
         * Create a new entity
         * @param name of entity
         * @return entity
         */
static void _entitas_world_ComponentAddedOrRemoved_entitas_event_entity_changed_handler (EntitasEntity* e, gint index, void* component, gpointer self) {
	entitas_world_ComponentAddedOrRemoved ((EntitasWorld*) self, e, index, component);
}


static void _entitas_world_onEntityReleased_entitas_event_entity_released_handler (EntitasEntity* e, gpointer self) {
	entitas_world_onEntityReleased ((EntitasWorld*) self, e);
}


static void _entitas_world_onComponentReplaced_entitas_event_component_replaced_handler (EntitasEntity* e, gint index, void* component, void* replacement, gpointer self) {
	entitas_world_onComponentReplaced ((EntitasWorld*) self, e, index, component, replacement);
}


EntitasEntity* entitas_world_CreateEntity (EntitasWorld* self, const gchar* name, gint pool, gboolean active) {
	EntitasEntity* result = NULL;
	gint _tmp0_;
	EntitasEntity* _tmp1_;
	gint _tmp1__length1;
	gint _tmp2_;
	gint _tmp3_;
	EntitasEntity _tmp4_ = {0};
	EntitasEntity _tmp5_;
	EntitasEntity* _tmp6_;
	gint _tmp6__length1;
	gint _tmp7_;
	const gchar* _tmp8_;
	EntitasEntity* _tmp9_;
	gint _tmp10_;
	EntitasEntity* _tmp11_;
	gboolean _tmp12_;
	EntitasEntity* _tmp13_;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (name != NULL, NULL);
	_tmp0_ = self->id;
	self->id = _tmp0_ + 1;
	_tmp1_ = self->pool;
	_tmp1__length1 = self->pool_length1;
	_tmp2_ = self->id;
	_tmp3_ = self->id;
	entitas_entity_init (&_tmp4_, _tmp3_, _entitas_world_ComponentAddedOrRemoved_entitas_event_entity_changed_handler, self, _entitas_world_onEntityReleased_entitas_event_entity_released_handler, self, _entitas_world_onComponentReplaced_entitas_event_component_replaced_handler, self);
	entitas_entity_destroy (&_tmp1_[_tmp2_]);
	_tmp1_[_tmp2_] = _tmp4_;
	_tmp5_ = _tmp1_[_tmp2_];
	_tmp6_ = self->pool;
	_tmp6__length1 = self->pool_length1;
	_tmp7_ = self->id;
	_tmp8_ = name;
	_tmp9_ = entitas_entity_SetName (&_tmp6_[_tmp7_], _tmp8_);
	_tmp10_ = pool;
	_tmp11_ = entitas_entity_SetPool (_tmp9_, _tmp10_);
	_tmp12_ = active;
	_tmp13_ = entitas_entity_SetActive (_tmp11_, _tmp12_);
	result = _tmp13_;
	return result;
}


/**
         * Gets all of the entities that match
         *
         * @param matcher to select for
         * @return the group
         */
static GList* g_list_get_Head (GList* self) {
	GList* result;
	GList* _tmp0_;
	_tmp0_ = g_list_first (self);
	result = _tmp0_;
	return result;
}


EntitasGroup* entitas_world_GetGroup (EntitasWorld* self, EntitasMatcher* matcher) {
	EntitasGroup* result = NULL;
	GList* _tmp0_;
	guint _tmp1_;
	EntitasMatcher* _tmp2_;
	gint _tmp3_;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (matcher != NULL, NULL);
	_tmp0_ = self->groups;
	_tmp1_ = g_list_length (_tmp0_);
	_tmp2_ = matcher;
	_tmp3_ = _tmp2_->id;
	if (_tmp1_ > ((guint) _tmp3_)) {
		GList* _tmp4_;
		EntitasMatcher* _tmp5_;
		gint _tmp6_;
		GList* _tmp7_;
		gconstpointer _tmp8_;
		EntitasGroup* _tmp9_;
		_tmp4_ = self->groups;
		_tmp5_ = matcher;
		_tmp6_ = _tmp5_->id;
		_tmp7_ = g_list_nth (_tmp4_, (guint) _tmp6_);
		_tmp8_ = _tmp7_->data;
		_tmp9_ = _entitas_group_retain0 ((EntitasGroup*) _tmp8_);
		result = _tmp9_;
		return result;
	} else {
		EntitasMatcher* _tmp10_;
		EntitasGroup* _tmp11_;
		EntitasEventGroupsChanged* _tmp22_;
		EntitasEventGroupsChangedHandler _tmp23_;
		void* _tmp23__target;
		GList* _tmp24_;
		GList* _tmp25_;
		GList* _tmp26_;
		gconstpointer _tmp27_;
		GList* _tmp28_;
		GList* _tmp29_;
		GList* _tmp30_;
		gconstpointer _tmp31_;
		EntitasGroup* _tmp32_;
		_tmp10_ = matcher;
		_tmp11_ = entitas_group_new (_tmp10_);
		self->groups = g_list_insert (self->groups, _tmp11_, 0);
		{
			gint i = 0;
			i = 0;
			{
				gboolean _tmp12_ = FALSE;
				_tmp12_ = TRUE;
				while (TRUE) {
					gint _tmp14_;
					gint _tmp15_;
					GList* _tmp16_;
					GList* _tmp17_;
					GList* _tmp18_;
					gconstpointer _tmp19_;
					EntitasEntity* _tmp20_;
					gint _tmp20__length1;
					gint _tmp21_;
					if (!_tmp12_) {
						gint _tmp13_;
						_tmp13_ = i;
						i = _tmp13_ + 1;
					}
					_tmp12_ = FALSE;
					_tmp14_ = i;
					_tmp15_ = self->id;
					if (!(_tmp14_ < (_tmp15_ - 1))) {
						break;
					}
					_tmp16_ = self->groups;
					_tmp17_ = g_list_get_Head (_tmp16_);
					_tmp18_ = _tmp17_;
					_tmp19_ = _tmp18_->data;
					_tmp20_ = self->pool;
					_tmp20__length1 = self->pool_length1;
					_tmp21_ = i;
					entitas_group_HandleEntitySilently ((EntitasGroup*) _tmp19_, &_tmp20_[_tmp21_]);
				}
			}
		}
		_tmp22_ = self->onGroupCreated;
		_tmp23_ = _tmp22_->Dispatch;
		_tmp23__target = _tmp22_->Dispatch_target;
		_tmp24_ = self->groups;
		_tmp25_ = g_list_get_Head (_tmp24_);
		_tmp26_ = _tmp25_;
		_tmp27_ = _tmp26_->data;
		_tmp23_ (self, (EntitasGroup*) _tmp27_, _tmp23__target);
		_tmp28_ = self->groups;
		_tmp29_ = g_list_get_Head (_tmp28_);
		_tmp30_ = _tmp29_;
		_tmp31_ = _tmp30_->data;
		_tmp32_ = _entitas_group_retain0 ((EntitasGroup*) _tmp31_);
		result = _tmp32_;
		return result;
	}
}


static void entitas_world_instance_init (EntitasWorld * self) {
	self->ref_count = 1;
	self->id = 0;
}


void entitas_world_free (EntitasWorld * self) {
	self->pool = (_vala_EntitasEntity_array_free (self->pool, self->pool_length1), NULL);
	self->systems = (_vala_EntitasISystem_array_free (self->systems, self->systems_length1), NULL);
	self->cache = (_vala_array_free (self->cache, self->cache_length1, (GDestroyNotify) g_ptr_array_unref), NULL);
	__g_list_free__entitas_group_release0_0 (self->groups);
	_entitas_event_world_changed_release0 (self->onEntityCreated);
	_entitas_event_world_changed_release0 (self->onEntityWillBeDestroyed);
	_entitas_event_world_changed_release0 (self->onEntityDestroyed);
	_entitas_event_groups_changed_release0 (self->onGroupCreated);
	g_slice_free (EntitasWorld, self);
}


static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	if ((array != NULL) && (destroy_func != NULL)) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}


static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}




